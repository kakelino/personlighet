<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Big Five - Persoonallisuustesti (60 väittämää) / Big Five - Personlighetstest (60 påståenden)</title>
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--accent:#2563eb;--muted:#6b7280}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; padding:24px}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    p.lead{margin:4px 0 0;color:var(--muted)}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(15,23,42,0.05)}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .questions{max-height:62vh;overflow:auto;padding-right:6px}
    .q{padding:10px;border-radius:8px;border:1px solid #eef2ff;margin-bottom:8px}
    .q .text{font-size:14px;margin-bottom:8px}
    .scale{display:flex;gap:6px}
    .scale label{flex:1;text-align:center;padding:8px 6px;border-radius:6px;border:1px solid #e6edf8;font-size:13px;cursor:pointer}
    .scale input{display:none}
    .scale input:checked + span{background:var(--accent);color:#fff;border-color:var(--accent)}
    .controls{display:flex;gap:8px;margin-top:12px}
    button{cursor:pointer;border:0;padding:10px 12px;border-radius:8px;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:transparent;border:1px solid #e6edf8}
    aside{position:sticky;top:24px}
    .results{margin-top:8px}
    .trait{display:flex;justify-content:space-between;padding:10px;border-radius:8px;border:1px dashed #e6edf8;margin-bottom:8px;background:#fbfdff}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    .langswitch{display:flex;gap:8px;margin-bottom:8px}
    @media(max-width:900px){.grid{grid-template-columns:1fr;}.questions{max-height:60vh}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="card" style="display:inline-block;padding:12px 14px">
        <strong>BF</strong>
      </div>
      <div>
        <h1 data-i18n="title">Big Five - Persoonallisuustesti (60 väittämää)</h1>
        <p class="lead" data-i18n="lead">Täytä väittämät asteikolla 1–5. Soveltuu itsearviointiin ja harjoitteluun — ei korvaa standardoituja testejä.</p>
      </div>
    </header>

    <div class="card langswitch" style="align-items:center">
      <div class="small" data-i18n="language">Kieli / Språk:</div>
      <select id="lang" style="padding:6px;border-radius:8px;border:1px solid #eef2ff">
        <option value="fi">Suomi (FI)</option>
        <option value="sv">Svenska (SV)</option>
      </select>
    </div>

    <div class="grid">
      <main class="card questions" id="questions"></main>

      <aside class="card">
        <div>
          <label data-i18n="labelName">Nimi (valinnainen)</label>
          <input id="name" placeholder="Esim. Maija" style="width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #eef2ff" />
        </div>

        <div class="controls">
          <button id="submit" class="btn-primary" data-i18n="btnCalculate">Laske tulos</button>
          <button id="reset" class="btn-ghost" data-i18n="btnReset">Tyhjennä</button>
        </div>

        <div class="results" id="results">
          <div class="small" style="margin-top:10px" data-i18n="results">Tulokset:</div>
          <div id="traits"></div>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="saveLocal" class="btn-ghost" data-i18n="btnSave">Tallenna selaimeen</button>
          <button id="downloadJSON" class="btn-ghost" data-i18n="btnJSON">Lataa JSON</button>
          <button id="downloadCSV" class="btn-ghost" data-i18n="btnCSV">Lataa CSV</button>
        </div>

        <div style="margin-top:12px">
          <canvas id="chart" width="300" height="220"></canvas>
        </div>

        <div class="small" style="margin-top:12px" data-i18n="note">Huom: Tulokset ovat suuntaa-antavia.</div>
      </aside>
    </div>

    <footer>Voit pyytää minulta tulkintaohjeet tai graafisen viennin.</footer>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // Käännös-dictionary (FI ja SV)
    const i18n = {
      fi: {
        title: 'Big Five - Persoonallisuustesti (60 väittämää)',
        lead: 'Täytä väittämät asteikolla 1–5. Soveltuu itsearviointiin ja harjoitteluun — ei korvaa standardoituja testejä.',
        language: 'Kieli / Språk:',
        labelName: 'Nimi (valinnainen)',
        btnCalculate: 'Laske tulos',
        btnReset: 'Tyhjennä',
        results: 'Tulokset:',
        btnSave: 'Tallenna selaimeen',
        btnJSON: 'Lataa JSON',
        btnCSV: 'Lataa CSV',
        note: 'Huom: Tulokset ovat suuntaa-antavia.'
      },
      sv: {
        title: 'Big Five - Personlighetstest (60 påståenden)',
        lead: 'Fyll i påståendena på en skala 1–5. Lämplig för självbedömning och övning — ersätter inte standardiserade tester.',
        language: 'Språk / Kieli:',
        labelName: 'Namn (valfritt)',
        btnCalculate: 'Beräkna resultat',
        btnReset: 'Rensa',
        results: 'Resultat:',
        btnSave: 'Spara i webbläsaren',
        btnJSON: 'Ladda ner JSON',
        btnCSV: 'Ladda ner CSV',
        note: 'Obs: Resultaten är vägledande.'
      }
    };

    // 60 väittämää (suomi tekstit). Ruotsiksi käännökset lisätään dynaamisesti yllä olevan objektin avulla
    const questions = [
      {id:'Q1', text_fi:'Pidän uusista ideoista ja konsepteista.', trait:'Openness', reverse:false},
      {id:'Q2', text_fi:'Nautin taiteesta ja kauneudesta.', trait:'Openness', reverse:false},
      {id:'Q3', text_fi:'Olen utelias monista eri aiheista.', trait:'Openness', reverse:false},
      {id:'Q4', text_fi:'Pidän tutkia uusia tapoja tehdä asioita.', trait:'Openness', reverse:false},
      {id:'Q5', text_fi:'Pidän abstrakteista ideoista enemmän kuin konkreettisista faktoista.', trait:'Openness', reverse:false},
      {id:'Q6', text_fi:'Välitän vähän taiteesta tai kulttuurista.', trait:'Openness', reverse:true},
      {id:'Q7', text_fi:'Pidän enemmän rutiineista kuin uusista kokemuksista.', trait:'Openness', reverse:true},
      {id:'Q8', text_fi:'Minulla on laaja kiinnostus erilaisiin harrastuksiin.', trait:'Openness', reverse:false},
      {id:'Q9', text_fi:'Helposti kyllästyn tuttuihin asioihin.', trait:'Openness', reverse:false},
      {id:'Q10', text_fi:'Pidän huomaamattani filosofisista pohdinnoista.', trait:'Openness', reverse:false},
      {id:'Q11', text_fi:'En ymmärrä modernia taidetta.', trait:'Openness', reverse:true},
      {id:'Q12', text_fi:'Pidän ideoiden ja mahdollisuuksien pohtimisesta.', trait:'Openness', reverse:false},
      {id:'Q13', text_fi:'Suunnittelen asiat huolellisesti etukäteen.', trait:'Conscientiousness', reverse:false},
      {id:'Q14', text_fi:'Täytän sovitut tehtävät ajallaan.', trait:'Conscientiousness', reverse:false},
      {id:'Q15', text_fi:'Pidän järjestyksestä ympärilläni.', trait:'Conscientiousness', reverse:false},
      {id:'Q16', text_fi:'Aloitan usein projekteja, mutta harvoin viimeistelen ne.', trait:'Conscientiousness', reverse:true},
      {id:'Q17', text_fi:'Pyrin tekemään parhaani työssäni.', trait:'Conscientiousness', reverse:false},
      {id:'Q18', text_fi:'Välttelen vastuuta, kun mahdollista.', trait:'Conscientiousness', reverse:true},
      {id:'Q19', text_fi:'Pidän tarkasta suunnittelusta ennen kuin aloitan.', trait:'Conscientiousness', reverse:false},
      {id:'Q20', text_fi:'Voin luottaa siihen, että pidän kiinni lupaamistani asioista.', trait:'Conscientiousness', reverse:false},
      {id:'Q21', text_fi:'Jätän usein asiat viime tippaan.', trait:'Conscientiousness', reverse:true},
      {id:'Q22', text_fi:'Teen asiat järjestelmällisesti.', trait:'Conscientiousness', reverse:false},
      {id:'Q23', text_fi:'Olen huolellinen yksityiskohtien suhteen.', trait:'Conscientiousness', reverse:false},
      {id:'Q24', text_fi:'En aina noudata sääntöjä tai ohjeita.', trait:'Conscientiousness', reverse:true},
      {id:'Q25', text_fi:'Tunnen oloni energiseksi sosiaalisissa tilanteissa.', trait:'Extraversion', reverse:false},
      {id:'Q26', text_fi:'Pidän puhumisesta ja esillä olemisesta.', trait:'Extraversion', reverse:false},
      {id:'Q27', text_fi:'Hain aktiivisesti uusia tuttavuuksia.', trait:'Extraversion', reverse:false},
      {id:'Q28', text_fi:'Vietän mieluummin aikaa yksin kuin isossa seurueessa.', trait:'Extraversion', reverse:true},
      {id:'Q29', text_fi:'Tunnen oloni mukavaksi huomion kohteena.', trait:'Extraversion', reverse:false},
      {id:'Q30', text_fi:'Pidän innostuksesta ja toiminnan täyteisistä päivistä.', trait:'Extraversion', reverse:false},
      {id:'Q31', text_fi:'Usein olen hiljaisempi kuin muut.', trait:'Extraversion', reverse:true},
      {id:'Q32', text_fi:'Helposti aloitan keskustelun vieraiden ihmisten kanssa.', trait:'Extraversion', reverse:false},
      {id:'Q33', text_fi:'Tunnen itseni vetäytyneeksi sosiaalisissa tilanteissa.', trait:'Extraversion', reverse:true},
      {id:'Q34', text_fi:'Pidän toiminnallisista tapahtumista ja juhlista.', trait:'Extraversion', reverse:false},
      {id:'Q35', text_fi:'Saan virtaa muiden seurassa olemisesta.', trait:'Extraversion', reverse:false},
      {id:'Q36', text_fi:'Usein olen ensimmäinen, joka liittyy keskusteluun.', trait:'Extraversion', reverse:false},
      {id:'Q37', text_fi:'Yleisesti ottaen luotan ihmisiin.', trait:'Agreeableness', reverse:false},
      {id:'Q38', text_fi:'Autan mieluusti muita ilman odotusta vastapalveluksesta.', trait:'Agreeableness', reverse:false},
      {id:'Q39', text_fi:'Välitän muiden tunteista.', trait:'Agreeableness', reverse:false},
      {id:'Q40', text_fi:'Kilpailu motivoi minua enemmän kuin yhteistyö.', trait:'Agreeableness', reverse:true},
      {id:'Q41', text_fi:'Olen valmis kompromisseihin ryhmän takia.', trait:'Agreeableness', reverse:false},
      {id:'Q42', text_fi:'Usein olen epäluuloinen toisten motiiveista.', trait:'Agreeableness', reverse:true},
      {id:'Q43', text_fi:'Pidän ystävällisyydestä arjessa.', trait:'Agreeableness', reverse:false},
      {id:'Q44', text_fi:'Minua ärsyttävät helposti muiden ihmisten tarpeet.', trait:'Agreeableness', reverse:true},
      {id:'Q45', text_fi:'Yleensä annan muiden etusijan, jos se ei ole haitallista.', trait:'Agreeableness', reverse:false},
      {id:'Q46', text_fi:'Olen helppo luottaa ja avoin keskustelulle.', trait:'Agreeableness', reverse:false},
      {id:'Q47', text_fi:'Pidän harmonisesta ilmapiiristä enemmän kuin huomion hakemisesta.', trait:'Agreeableness', reverse:false},
      {id:'Q48', text_fi:'Saatan tehdä tarvittaessa ankaran päätöksen, vaikka se loukkaisikin muita.', trait:'Agreeableness', reverse:true},
      {id:'Q49', text_fi:'Koen usein huolta tai ahdistusta.', trait:'Neuroticism', reverse:false},
      {id:'Q50', text_fi:'Tunteeni muuttuvat helposti päivän aikana.', trait:'Neuroticism', reverse:false},
      {id:'Q51', text_fi:'Reagoin voimakkaasti stressaaviin tilanteisiin.', trait:'Neuroticism', reverse:false},
      {id:'Q52', text_fi:'Pystyn pitämään tunteeni tasapainossa (vastakkainen).', trait:'Neuroticism', reverse:true},
      {id:'Q53', text_fi:'Minulla on taipumusta huolehtia asioista liikaa.', trait:'Neuroticism', reverse:false},
      {id:'Q54', text_fi:'Yleensä palaudun nopeasti vastoinkäymisistä (vastakkainen).', trait:'Neuroticism', reverse:true},
      {id:'Q55', text_fi:'Tunnen usein epämukavuutta sosiaalisissa tilanteissa.', trait:'Neuroticism', reverse:false},
      {id:'Q56', text_fi:'Minulla on vaikeuksia päästä yli pettymyksistä.', trait:'Neuroticism', reverse:false},
      {id:'Q57', text_fi:'Harvoin tunnen itseni surulliseksi (vastakkainen).', trait:'Neuroticism', reverse:true},
      {id:'Q58', text_fi:'Stressi vaikuttaa helposti uneeni tai ruokahaluuni.', trait:'Neuroticism', reverse:false},
      {id:'Q59', text_fi:'Pelkään usein tulevaisuuden epävarmuuksia.', trait:'Neuroticism', reverse:false},
      {id:'Q60', text_fi:'Yleisesti tunnen itseni emotionaalisesti vakaaksi (vastakkainen).', trait:'Neuroticism', reverse:true}
    ];

    // Ruotsin käännökset (tekstikentille) — yksinkertainen setti
    const svTranslations = {
      'Pidän uusista ideoista ja konsepteista.':'Jag gillar nya idéer och koncept.',
      'Nautin taiteesta ja kauneudesta.':'Jag njuter av konst och skönhet.',
      'Olen utelias monista eri aiheista.':'Jag är nyfiken på många olika ämnen.',
      'Pidän tutkia uusia tapoja tehdä asioita.':'Jag gillar att utforska nya sätt att göra saker.',
      'Pidän abstrakteista ideoista enemmän kuin konkreettisista faktoista.':'Jag föredrar abstrakta idéer framför konkreta fakta.',
      'Välitän vähän taiteesta tai kulttuurista.':'Jag bryr mig inte mycket om konst eller kultur.',
      'Pidän enemmän rutiineista kuin uusista kokemuksista.':'Jag föredrar rutiner framför nya upplevelser.',
      'Minulla on laaja kiinnostus erilaisiin harrastuksiin.':'Jag har ett brett intresse för olika hobbyer.',
      'Helposti kyllästyn tuttuihin asioihin.':'Jag blir lätt uttråkad av det bekanta.',
      'Pidän huomaamattani filosofisista pohdinnoista.':'Jag finner mig själv i filosofiska tankar.',
      'En ymmärrä modernia taidetta.':'Jag förstår inte modern konst.',
      'Pidän ideoiden ja mahdollisuuksien pohtimisesta.':'Jag gillar att fundera på idéer och möjligheter.',
      'Suunnittelen asiat huolellisesti etukäteen.':'Jag planerar saker noggrant i förväg.',
      'Täytän sovitut tehtävät ajallaan.':'Jag fullföljer uppgifter i tid.',
      'Pidän järjestyksestä ympärilläni.':'Jag gillar ordning omkring mig.',
      'Aloitan usein projekteja, mutta harvoin viimeistelen ne.':'Jag börjar ofta projekt men slutför sällan dem.',
      'Pyrin tekemään parhaani työssäni.':'Jag strävar efter att göra mitt bästa i arbetet.',
      'Välttelen vastuuta, kun mahdollista.':'Jag undviker ansvar när det är möjligt.',
      'Pidän tarkasta suunnittelusta ennen kuin aloitan.':'Jag gillar att planera noggrant innan jag börjar.',
      'Voin luottaa siihen, että pidän kiinni lupaamistani asioista.':'Du kan lita på att jag håller mina löften.',
      'Jätän usein asiat viime tippaan.':'Jag lämnar ofta saker till sista minuten.',
      'Teen asiat järjestelmällisesti.':'Jag gör saker systematiskt.',
      'Olen huolellinen yksityiskohtien suhteen.':'Jag är noggrann med detaljer.',
      'En aina noudata sääntöjä tai ohjeita.':'Jag följer inte alltid regler eller instruktioner.',
      'Tunnen oloni energiseksi sosiaalisissa tilanteissa.':'Jag känner mig energisk i sociala situationer.',
      'Pidän puhumisesta ja esillä olemisesta.':'Jag gillar att prata och vara i centrum.',
      'Hain aktiivisesti uusia tuttavuuksia.':'Jag söker aktivt nya bekantskaper.',
      'Vietän mieluummin aikaa yksin kuin isossa seurueessa.':'Jag föredrar att vara ensam framför stora sällskap.',
      'Tunnen oloni mukavaksi huomion kohteena.':'Jag känner mig bekväm i centrum av uppmärksamheten.',
      'Pidän innostuksesta ja toiminnan täyteisistä päivistä.':'Jag gillar spännande och aktiva dagar.',
      'Usein olen hiljaisempi kuin muut.':'Jag är ofta tystare än andra.',
      'Helposti aloitan keskustelun vieraiden ihmisten kanssa.':'Jag startar lätt konversationer med främlingar.',
      'Tunnen itseni vetäytyneeksi sosiaalisissa tilanteissa.':'Jag känner mig tillbakadragen i sociala situationer.',
      'Pidän toiminnallisista tapahtumista ja juhlista.':'Jag gillar aktiva evenemang och fester.',
      'Saan virtaa muiden seurassa olemisesta.':'Jag får energi av att vara med andra.',
      'Usein olen ensimmäinen, joka liittyy keskusteluun.':'Jag är ofta den första som går med i en konversation.',
      'Yleisesti ottaen luotan ihmisiin.':'Generellt litar jag på människor.',
      'Autan mieluusti muita ilman odotusta vastapalveluksesta.':'Jag hjälper gärna andra utan att förvänta mig något tillbaka.',
      'Välitän muiden tunteista.':'Jag bryr mig om andras känslor.',
      'Kilpailu motivoi minua enemmän kuin yhteistyö.':'Konkurrens motiverar mig mer än samarbete.',
      'Olen valmis kompromisseihin ryhmän takia.':'Jag är villig att kompromissa för gruppens skull.',
      'Usein olen epäluuloinen toisten motiiveista.':'Jag är ofta misstänksam mot andras motiv.',
      'Pidän ystävällisyydestä arjessa.':'Jag uppskattar vänlighet i vardagen.',
      'Minua ärsyttävät helposti muiden ihmisten tarpeet.':'Andras behov irriterar mig lätt.',
      'Yleensä annan muiden etusijan, jos se ei ole haitallista.':'Jag ger oftast andra företräde om det inte är skadligt.',
      'Olen helppo luottaa ja avoin keskustelulle.':'Jag är lätt att lita på och öppen för samtal.',
      'Pidän harmonisesta ilmapiiristä enemmän kuin huomion hakemisesta.':'Jag föredrar en harmonisk atmosfär framför uppmärksamhetssökande.',
      'Saatan tehdä tarvittaessa ankaran päätöksen, vaikka se loukkaisikin muita.':'Jag kan fatta tuffa beslut vid behov, även om det sårar andra.',
      'Koen usein huolta tai ahdistusta.':'Jag upplever ofta oro eller ångest.',
      'Tunteeni muuttuvat helposti päivän aikana.':'Mina känslor ändras lätt under dagen.',
      'Reagoin voimakkaasti stressaaviin tilanteisiin.':'Jag reagerar starkt på stressande situationer.',
      'Pystyn pitämään tunteeni tasapainossa (vastakkainen).':'Jag kan hålla mina känslor i balans (motsatt).',
      'Minulla on taipumusta huolehtia asioista liikaa.':'Jag tenderar att oroa mig för mycket.',
      'Yleensä palaudun nopeasti vastoinkäymisistä (vastakkainen).':'Jag återhämtar mig vanligtvis snabbt från motgångar (motsatt).',
      'Tunnen usein epämukavuutta sosiaalisissa tilanteissa.':'Jag känner ofta obehag i sociala situationer.',
      'Minulla on vaikeuksia päästä yli pettymyksistä.':'Jag har svårt att komma över besvikelser.',
      'Harvoin tunnen itseni surulliseksi (vastakkainen).':'Jag känner mig sällan ledsen (motsatt).',
      'Stressi vaikuttaa helposti uneeni tai ruokahaluuni.':'Stress påverkar lätt min sömn eller aptit.',
      'Pelkään usein tulevaisuuden epävarmuuksia.':'Jag är ofta rädd för framtidens osäkerheter.',
      'Yleisesti tunnen itseni emotionaalisesti vakaaksi (vastakkainen).':'Generellt känner jag mig känslomässigt stabil (motsatt).'
    };

    // Render-koodi
    const questionsEl = document.getElementById('questions');
    function render(lang='fi'){
      questionsEl.innerHTML = '';
      questions.forEach((q, idx)=>{
        const div=document.createElement('div'); div.className='q';
        const num=document.createElement('div'); num.className='small'; num.textContent = `#${idx+1}`;
        const txt=document.createElement('div'); txt.className='text';
        const text = lang==='fi' ? q.text_fi : (svTranslations[q.text_fi] || q.text_fi);
        txt.textContent = text + (q.reverse? ` (${lang==='fi'?'käänteinen':'omvänd'})` : '');
        const scale=document.createElement('div'); scale.className='scale';
        for(let i=1;i<=5;i++){ const id=`${q.id}_v${i}`; const label=document.createElement('label'); const input=document.createElement('input'); input.type='radio'; input.name=q.id; input.id=id; input.value=i; input.addEventListener('change', saveProgress);
          const span=document.createElement('span'); span.textContent = i; label.appendChild(input); label.appendChild(span); scale.appendChild(label);
        }
        div.appendChild(num); div.appendChild(txt); div.appendChild(scale); questionsEl.appendChild(div);
      });
    }

    function getResponses(){ const res={}; questions.forEach(q=>{ const el=document.querySelector(`input[name="${q.id}"]:checked`); res[q.id]=el?Number(el.value):null; }); return res; }

    function score(responses){ const traits={Openness:[],Conscientiousness:[],Extraversion:[],Agreeableness:[],Neuroticism:[]}; questions.forEach(q=>{ const v=responses[q.id]; if(v==null) return; const sc = q.reverse ? (6 - v) : v; traits[q.trait].push(sc); }); const averages={}; Object.keys(traits).forEach(t=>{ const arr=traits[t]; averages[t] = arr.length ? +(arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(2) : null; }); return averages; }

    function showResults(){ const res=getResponses(); const sc=score(res); renderTraits(sc); updateChart(sc); localStorage.setItem('bigfive_last_result', JSON.stringify({name:document.getElementById('name').value||null,timestamp:new Date().toISOString(),scores:sc})); }

    function renderTraits(sc){ const traitsEl=document.getElementById('traits'); traitsEl.innerHTML=''; Object.entries(sc).forEach(([k,v])=>{ const div=document.createElement('div'); div.className='trait'; const left=document.createElement('div'); left.innerHTML=`<strong>${k}</strong><div class="small">(keskiarvo)</div>`; const right=document.createElement('div'); right.innerHTML = v!==null?`<strong>${v}</strong>`:'<span class="small">puuttuu vastauksia</span>'; div.appendChild(left); div.appendChild(right); traitsEl.appendChild(div);} ); }

    function saveProgress(){ const res=getResponses(); localStorage.setItem('bigfive_progress', JSON.stringify({responses:res,name:document.getElementById('name').value||''})); }
    function loadProgress(){ const data=JSON.parse(localStorage.getItem('bigfive_progress')||'null'); if(!data) return; if(data.name) document.getElementById('name').value=data.name; const responses=data.responses||{}; Object.entries(responses).forEach(([k,v])=>{ if(v==null) return; const input=document.querySelector(`input[name="${k}"][value="${v}"]`); if(input) input.checked=true; }); }
    function resetAll(){ document.querySelectorAll('input[type=radio]').forEach(i=>i.checked=false); document.getElementById('name').value=''; localStorage.removeItem('bigfive_progress'); document.getElementById('traits').innerHTML=''; updateChart(null); }

    function downloadJSON(){ const payload={name:document.getElementById('name').value||null,timestamp:new Date().toISOString(),responses:getResponses(),scores:score(getResponses())}; const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`bigfive_results_${new Date().toISOString()}.json`; a.click(); URL.revokeObjectURL(url); }

 function downloadCSV() {
  const sc = score(getResponses());
  const rows = [['trait', 'value']];

  for (const [trait, value] of Object.entries(sc)) {
    rows.push([trait, value]);
  }

  // Muutetaan riveiksi ja rivinvaihdoiksi
  const csvContent = rows.map(e => e.join(',')).join('\n');

  // Luodaan tiedosto
  const blob = new Blob(
    ["\uFEFF" + csvContent], // \uFEFF varmistaa UTF-8-merkistön (ä, ö, å näkyvät oikein)
    { type: 'text/csv;charset=utf-8;' }
  );

  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `bigfive_results_${new Date().toISOString()}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}


    // Chart.js setup
    const ctx = document.getElementById('chart').getContext('2d');
    let chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Openness','Conscientiousness','Extraversion','Agreeableness','Neuroticism'],
        datasets: [{ label: 'Score (avg)', data: [0,0,0,0,0] }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { y: { beginAtZero: true, max:5 } }
      }
    });

    function updateChart(sc){ if(!sc){ chart.data.datasets[0].data = [0,0,0,0,0]; chart.update(); return; } const vals = ['Openness','Conscientiousness','Extraversion','Agreeableness','Neuroticism'].map(k=>sc[k]||0); chart.data.datasets[0].data = vals; chart.update(); }

    // Event listeners
    document.getElementById('submit').addEventListener('click', ()=>{ showResults(); window.scrollTo({top:0,behavior:'smooth'}); });
    document.getElementById('reset').addEventListener('click', ()=>{ if(confirm('Haluatko tyhjentää kaikki vastaukset?')) resetAll(); });
    document.getElementById('saveLocal').addEventListener('click', ()=>{ const payload={name:document.getElementById('name').value||null,timestamp:new Date().toISOString(),responses:getResponses(),scores:score(getResponses())}; const key='bigfive_saved_'+new Date().toISOString(); localStorage.setItem(key,JSON.stringify(payload)); alert('Tallennettu selaimen localStorageen.'); });
    document.getElementById('downloadJSON').addEventListener('click', downloadJSON);
    document.getElementById('downloadCSV').addEventListener('click', downloadCSV);

    // Language switch
    const langSel = document.getElementById('lang');
    langSel.addEventListener('change', ()=>{ const lang = langSel.value; applyLang(lang); render(lang); loadProgress(); });
    function applyLang(lang){ document.querySelectorAll('[data-i18n]').forEach(el=>{ const key = el.getAttribute('data-i18n'); if(i18n[lang] && i18n[lang][key]) el.textContent = i18n[lang][key]; }); // update placeholders
      if(lang==='sv'){ document.getElementById('name').placeholder = 'Ex. Maria'; }
      else { document.getElementById('name').placeholder = 'Esim. Maija'; }
    }

    // Initial render
    render('fi'); applyLang('fi'); loadProgress(); updateChart(null);

  </script>
</body>
</html>
